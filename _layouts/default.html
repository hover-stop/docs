<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title | default: site.title }}</title>
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
</head>
<body>
  <header>
    <img src="{{ '/assets/img/logo.png' | relative_url }}" alt="HoverStop Logo">
  </header>
  <nav>
    <div class="nav-container">
      <a href="{{ '/' | relative_url }}">Home</a>
      {% assign content_sections = site.pages | map: 'dir' | uniq | sort %}
      {% for section in content_sections %}
        {% if section contains '/content/' and section != '/content/' %}
          <a href="{{ section | relative_url }}">{{ section | split: '/' | last | replace: '-', ' ' | capitalize }}</a>
        {% endif %}
      {% endfor %}
    </div>
  </nav>
  
  <div class="content-wrapper">
    {% if page.name == 'index.md' and page.path contains 'content/' and page.dir != '/content/' %}
      <main>
        <div class="page-content">
          {{ content }}
        </div>
        <div class="guides-container">
          {% assign section_pages = site.pages | where: "dir", page.dir | sort: "nav_order" %}
          {% for child in section_pages %}
            {% if child.name != 'index.md' and child.dir == page.dir %}
              <div class="guide-card">
                <a href="{{ child.url | relative_url }}">
                  <h3>{{ child.title }}</h3>
                  <div class="guide-meta">
                    <span class="guide-type">Guide</span>
                  </div>
                  <div class="guide-arrow">â†’</div>
                </a>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </main>
    {% elsif page.path == '/content/index.md' %}
      <main>
        <div class="page-content">
          {{ content }}
        </div>
        <div class="guides-container">
          {% assign sections = site.pages | map: 'dir' | uniq | sort %}
          {% for section in sections %}
            {% if section contains '/content/' and section != '/content/' %}
              <div class="guide-card">
                <a href="{{ section | relative_url }}">{{ section | split: '/' | last | replace: '-', ' ' | capitalize }}</a>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </main>
    {% elsif page.path contains 'content/' and page.dir != '/content/' %}
      <!-- Child guide: sidebar + content in flex row -->
      <div style="display: flex;">
        <aside class="sidebar" style="position: static; height: auto; min-width: 220px; max-width: 260px; margin-right: 2rem;">
          <h3>{{ page.dir | split: '/' | last | replace: '-', ' ' | capitalize }}</h3>
          <ul class="section-nav">
            {% assign section_pages = site.pages | where: "dir", page.dir | sort: "nav_order" %}
            {% for sibling in section_pages %}
              {% if sibling.name != 'index.md' %}
              <li {% if page.url == sibling.url %}class="active"{% endif %}>
                <a href="{{ sibling.url | relative_url }}">{{ sibling.title }}</a>
              </li>
              {% endif %}
            {% endfor %}
          </ul>
        </aside>
        <main class="with-sidebar" style="flex: 1;">
          <div class="page-content">
            {{ content }}
          </div>
        </main>
      </div>
    {% else %}
      <!-- All other pages: just content -->
      <main>
        <div class="page-content">
          {{ content }}
        </div>
      </main>
    {% endif %}
  </div>

  <script>
    // Function to adjust sidebar height to match content
    function adjustSidebarHeight() {
      const sidebar = document.querySelector('.sidebar');
      const content = document.querySelector('.content-wrapper');
      
      if (sidebar && content) {
        // Set sidebar height to match content height
        sidebar.style.height = content.offsetHeight + 'px';
      }
    }
    
    // Run on page load
    document.addEventListener('DOMContentLoaded', adjustSidebarHeight);
    
    // Also run when details elements are toggled (for collapsible sections)
    document.querySelectorAll('details').forEach(detail => {
      detail.addEventListener('toggle', () => {
        // Small delay to allow content to expand/collapse
        setTimeout(adjustSidebarHeight, 50);
      });
    });
    
    // Run when window is resized
    window.addEventListener('resize', adjustSidebarHeight);
  </script>
</body>
</html>